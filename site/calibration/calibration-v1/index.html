<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Version 1 - Project North Star</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/docco.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Project North Star</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Getting Started <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../hi/gi" class="dropdown-item">Test</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Mechanical <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../mechanical/" class="dropdown-item">Getting Started</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Leap Motion Release 3</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../mechanical/leap-motion-r3/" class="dropdown-item">Getting Started</a>
</li>
            
<li>
    <a href="../../mechanical/leap-motion-r3/headset-bom.md" class="dropdown-item">Bill of Materials</a>
</li>
            
<li>
    <a href="../../mechanical/leap-motion-r3/headset-assembly/" class="dropdown-item">Assembly Guide</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Leap Motion Release 1</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../mechanical/leap-motion-v1/v1-assembly-guide.md" class="dropdown-item">Assembly Guide</a>
</li>
            
<li>
    <a href="../../mechanical/leap-motion-v1/v1-3d-print-reference.md" class="dropdown-item">3D Print Reference</a>
</li>
    </ul>
  </li>
                                    
<li>
    <a href="../../mechanical/smart-prototyping-kits/" class="dropdown-item">Smart Prototyping Kits</a>
</li>
                                    
<li>
    <a href="https://exiii.jp/2018/07/25/project_north_star_en/" class="dropdown-item">Exii Version 1</a>
</li>
                                    
<li>
    <a href="../../mechanical/changelog/" class="dropdown-item">Changelog</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Software <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../software/getting-started/" class="dropdown-item">Getting Started</a>
</li>
                                    
<li>
    <a href="../../software/steamvr/" class="dropdown-item">SteamVR</a>
</li>
                                    
<li>
    <a href="../../software/" class="dropdown-item">FAQ</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Calibration <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../" class="dropdown-item">Getting Started</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">Version 1</a>
</li>
                                    
<li>
    <a href="../calibration-v2/" class="dropdown-item">Version 2</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Electronics <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../electronics/electronics/" class="dropdown-item">Electronics</a>
</li>
                                    
<li>
    <a href="../../electronics/firmware/" class="dropdown-item">Firmware</a>
</li>
                                    
<li>
    <a href="../../electronics/schematics/" class="dropdown-item">Schematics</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Community Links <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="https://discordapp.com/invite/NghjdX7" class="dropdown-item">Discord</a>
</li>
                                    
<li>
    <a href="https://twitter.com/search?q=%23ProjectNorthStar" class="dropdown-item">Twitter</a>
</li>
                                    
<li>
    <a href="https://www.reddit.com/r/ProjectNorthStar/" class="dropdown-item">Reddit</a>
</li>
                                    
<li>
    <a href="https://forums.leapmotion.com/t/project-north-star/7071" class="dropdown-item">Leap Motion Forums</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Leap Motion Blogs <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="http://blog.leapmotion.com/tag/north-star/" class="dropdown-item">Blog</a>
</li>
                                    
<li>
    <a href="http://blog.leapmotion.com/bending-reality-north-stars-calibration-system/" class="dropdown-item">Bending Reality North Starâ€™s Calibration System</a>
</li>
                                    
<li>
    <a href="http://blog.leapmotion.com/project-north-star-mechanical-update-3/" class="dropdown-item">Project North Star Mechanical Update 3</a>
</li>
                                    
<li>
    <a href="http://blog.leapmotion.com/project-north-star-mechanical-and-calibration-update-3-1/" class="dropdown-item">Project North Star Mechanical and Calibration Update 3.1</a>
</li>
                                    
<li>
    <a href="http://blog.leapmotion.com/project-north-star-mechanical-update-1/" class="dropdown-item">Project North Star Mechanical Update 1</a>
</li>
                                    
<li>
    <a href="http://blog.leapmotion.com/north-star-open-source/" class="dropdown-item">Project North Star is Now Open Source</a>
</li>
                                    
<li>
    <a href="http://blog.leapmotion.com/our-journey-to-the-north-star/" class="dropdown-item">Our Journey to the North Star</a>
</li>
                                    
<li>
    <a href="http://blog.leapmotion.com/northstar/" class="dropdown-item">Unveiling Project North Star</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../calibration-v2/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="2"><a href="#1-build-the-calibration-rig" class="nav-link">1. Build the Calibration Rig</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#2-calibrate-the-lenses-on-your-stereo-cameras" class="nav-link">2. Calibrate the lenses on your stereo cameras:</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#3-calibrate-the-optical-assembly-on-your-north-star" class="nav-link">3. Calibrate the Optical Assembly on your North Star</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h2 id="1-build-the-calibration-rig">1. Build the Calibration Rig</h2>
<p>This requires:</p>
<ol>
<li>
<p>3D Printing the mechanical assembly, search for it in <a href="/mechanical">Mechanical</a></p>
</li>
<li>
<p>Affixing two (2) of <a href="https://www.amazon.com/ELP-Industrial-Application-Synchronized-ELP-960P2CAM-V90-VC/dp/B078TDLHCP/">these Stereo Cameras</a> to it.</p>
</li>
<li>
<p>Acquiring a large secondary monitor to use as the calibration target</p>
</li>
<li>
<p>Find the exact model and active area of the screen for this monitor; we'll need it in 3)</p>
</li>
</ol>
<h2 id="2-calibrate-the-lenses-on-your-stereo-cameras">2. Calibrate the lenses on your stereo cameras:</h2>
<ul>
<li>Print out an OpenCV calibration chessboard, and affixing it to a flat backing board.</li>
<li>Flatness is absolutely crucial for the calibration.</li>
<li>Editing the config variables at the top of <code>dualStereoChessboardCalibration.py</code> with the correct:</li>
<li>Number of interior corners on each axis</li>
<li>Dimensions of each square on the checkerboard (in meters!)</li>
<li>Install Python 3 on your machine and run <code>pip install numpy</code> and <code>pip install opencv-contrib-python</code></li>
<li>Run it from the python scripts folder, usually something like <code>C:\Users\*USERNAME*\AppData\Local\Programs\Python\Python36\Scripts</code></li>
<li>Running <code>dualStereoChessboardCalibration.py</code></li>
<li>First, ensure that your upper stereo camera appears on top in the camera visualizer</li>
<li>If not, exit the program, and unplug/replug your cameras' USB ports in various orders/ports until they do.</li>
<li>Hold your checkerboard in front of your camera array, ensuring to move it around to gain good coverage.</li>
<li>Every time the calibrator takes a snapshot, it will print a notice in the terminal.</li>
<li>After 30 snapshots in both camera views, it will run the calibration routines and display rectified views.</li>
<li>If the calibration went well, you will see your live camera stream rectified such that all straight lines in the real world will appear straight in the camera image, and the images will look straightened and vertically aligned between the screens.<ul>
<li>If this happened, congratulations!  Exit out of the program and run it one more time.</li>
<li>Running it again verifies the calibration can be loaded AND GENERATES THE CALIBRATION JSON</li>
</ul>
</li>
<li>If the calibration did not go well (you see horrible warping and badness), you can attempt the calibration again by:<ul>
<li>Deleting the created <code>dualCameraCalibration.npz</code> AND <code>cameraCalibration.json</code> files from the main folder</li>
<li>Trying again: ensuring the checkerboard is flat, the config parameters are correct, and that you have good coverage (including along depth)</li>
</ul>
</li>
</ul>
<h2 id="3-calibrate-the-optical-assembly-on-your-north-star">3. Calibrate the Optical Assembly on your North Star</h2>
<ul>
<li>You should have a good <code>cameraCalibration.json</code> file in the main folder (from the last step)</li>
<li>Ensure that your main monitor is 1920x1080 is and the Calibration Monitor appears to the left of the main monitor, and the north star display appears to the right of it.</li>
<li>This ensures that the automatic layouting algorithm detects the various monitors appropriately.</li>
<li>Edit <code>config.json</code> to have the active area for your calibration monitor you found earlier.</li>
<li>Download this version of the Leap Service: <a href="https://github.com/leapmotion/UnityModules/tree/feat-multi-device/Multidevice%20Service">https://github.com/leapmotion/UnityModules/tree/feat-multi-device/Multidevice%20Service</a></li>
<li>The calibrator was built with this version; it will complain if you don't have it :/</li>
<li>Now Run the <code>NorthStarCalibrator.exe</code></li>
<li>You should see the top camera's images in the top right, and the bottom camera's images on the bottom.</li>
<li>If this is not so, please reconnect your cameras until it is (same process as for the checkerboard script)</li>
<li>You should also see a set of sliders and buttons running along the top.</li>
<li>These control the calibration process.</li>
<li>First, point the bare calibration rig toward the calibration monitor</li>
<li>Ensure it is roughly centered on the monitor, so it can see all of the vertical area.</li>
<li>Then Press "1) Align Monitor Transform"</li>
<li>This will attempt to localize the monitor in space relative to the calibration rig.   This is important for the later steps.</li>
<li>Next, place the headset onto the calibration rig and press "2) Create Reflector Mask"</li>
<li>This should mask out all of the camera's FoV except the region where the screen and reflectors overlap the calibration monitor.</li>
<li>If it does not appear to do this, double check that all of the prior steps have been followed correctly...</li>
<li>Now, before we press "3) Toggle Optimization", we'll want to adjust the bottom two sliders until the both represent roughly equal brightnesses.</li>
<li>This is important since the optimizer is trying to create a configuration that yields a perfectly gray viewing area.</li>
<li>Now press "3) Toggle Optimization" and observe it.</li>
<li>It's switching between being valid for the upper and lower camera views, so only one image is going to appear to improve at a time.</li>
<li>You should it see it gradually discovering where the aligned camera location is.</li>
<li>This is the finickiest step in the process, it's possible that the headset is outside the standard build tolerances.  <ul>
<li>If you suspect this is the case, increase the simplexSize in the <code>config.json</code> to increase the area it will search.</li>
</ul>
</li>
<li>If it does converge on an aligned image, then congratulations!  Toggle the optimization off again.</li>
<li>Press button 4) to hide the pattern, put the headset on, and use the arrow keys to adjust the view dependent/ergonomic distortion and the numpad 2,4,6,8 keys to adjust the rotation of the leap peripheral.</li>
<li>When satisfied, press 5) to Save the Calibration</li>
<li>This will save your calibration as a "Temp" calibration in the <code>Calibrations</code> Folder (a shortcut is available in the main folder).</li>
<li>You can differentiate between calibrations by the time in which they were created.</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
